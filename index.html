import React, { useState, useEffect, useRef } from 'react';
import { MapPin, Star, Clock, DollarSign, Navigation, Heart, Sparkles, Send, X } from 'lucide-react';

const samplePlaces = [
  {
    id: 1,
    name: "Emerald Spa & Wellness",
    category: "spa",
    lat: -7.8753,
    lng: 112.0101,
    price: 150000,
    rating: 4.8,
    image: "https://images.unsplash.com/photo-1540555700478-4be289fbecef?w=400",
    description: "Spa premium dengan terapi aromaterapi dan massage tradisional",
    openHours: "09:00-21:00",
    services: ["Aromatherapy", "Thai Massage", "Facial Treatment"]
  },
  {
    id: 2,
    name: "Warung Nasi Pecel Bu Kaji",
    category: "food",
    lat: -7.8723,
    lng: 112.0145,
    price: 15000,
    rating: 4.6,
    image: "https://images.unsplash.com/photo-1596040033229-a0b55ee3c4f5?w=400",
    description: "Kuliner lokal autentik dengan cita rasa tradisional",
    openHours: "06:00-14:00",
    services: ["Nasi Pecel", "Rawon", "Soto"]
  },
  {
    id: 3,
    name: "Air Terjun Coban Rondo",
    category: "tourism",
    lat: -7.8950,
    lng: 112.0550,
    price: 25000,
    rating: 4.7,
    image: "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400",
    description: "Destinasi wisata alam dengan pemandangan air terjun yang menakjubkan",
    openHours: "07:00-17:00",
    services: ["Trekking", "Photography Spot", "Camping Area"]
  },
  {
    id: 4,
    name: "Relaxation Heaven Spa",
    category: "spa",
    lat: -7.8800,
    lng: 112.0200,
    price: 200000,
    rating: 4.9,
    image: "https://images.unsplash.com/photo-1544161515-4ab6ce6db874?w=400",
    description: "Spa mewah dengan pemandangan gunung",
    openHours: "10:00-22:00",
    services: ["Hot Stone", "Body Scrub", "Jacuzzi"]
  },
  {
    id: 5,
    name: "Sate Kelinci Pak Budi",
    category: "food",
    lat: -7.8700,
    lng: 112.0180,
    price: 35000,
    rating: 4.5,
    image: "https://images.unsplash.com/photo-1529193591184-b1d58069ecdd?w=400",
    description: "Sate kelinci legendaris dengan bumbu kacang spesial",
    openHours: "11:00-21:00",
    services: ["Sate Kelinci", "Sate Ayam", "Tongseng"]
  },
  {
    id: 6,
    name: "Taman Rekreasi Selecta",
    category: "tourism",
    lat: -7.8650,
    lng: 112.0480,
    price: 30000,
    rating: 4.6,
    image: "https://images.unsplash.com/photo-1501594907352-04cda38ebc29?w=400",
    description: "Taman rekreasi keluarga dengan kolam renang dan taman bunga",
    openHours: "08:00-18:00",
    services: ["Swimming Pool", "Flower Garden", "Playground"]
  }
];

export default function App() {
  const [places] = useState(samplePlaces);
  const [filteredPlaces, setFilteredPlaces] = useState([]);
  const [userLocation, setUserLocation] = useState(null);
  const [radius, setRadius] = useState(10);
  const [category, setCategory] = useState('all');
  const [budget, setBudget] = useState(1000000);
  const [favorites, setFavorites] = useState([]);
  const [selectedPlace, setSelectedPlace] = useState(null);
  const [showModal, setShowModal] = useState(false);
  const [showAI, setShowAI] = useState(false);
  const [aiMessages, setAiMessages] = useState([]);
  const [aiInput, setAiInput] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const chatEndRef = useRef(null);

  useEffect(() => {
    const savedFavs = localStorage.getItem('favorites');
    if (savedFavs) setFavorites(JSON.parse(savedFavs));
    getUserLocation();
  }, []);

  useEffect(() => {
    if (userLocation) {
      filterPlaces();
    }
  }, [userLocation, radius, category, budget]);

  useEffect(() => {
    localStorage.setItem('favorites', JSON.stringify(favorites));
  }, [favorites]);

  useEffect(() => {
    chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  }, [aiMessages]);

  const getUserLocation = () => {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          setUserLocation({
            lat: position.coords.latitude,
            lng: position.coords.longitude
          });
        },
        () => {
          setUserLocation({ lat: -7.8753, lng: 112.0101 });
        }
      );
    } else {
      setUserLocation({ lat: -7.8753, lng: 112.0101 });
    }
  };

  const calculateDistance = (lat1, lon1, lat2, lon2) => {
    const R = 6371;
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
              Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
              Math.sin(dLon/2) * Math.sin(dLon/2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
  };

  const filterPlaces = () => {
    if (!userLocation) return;

    const filtered = places
      .map(place => ({
        ...place,
        distance: calculateDistance(
          userLocation.lat,
          userLocation.lng,
          place.lat,
          place.lng
        )
      }))
      .filter(place => {
        const withinRadius = place.distance <= radius;
        const withinBudget = place.price <= budget;
        const matchCategory = category === 'all' || place.category === category;
        return withinRadius && withinBudget && matchCategory;
      })
      .sort((a, b) => a.distance - b.distance);

    setFilteredPlaces(filtered);
  };

  const toggleFavorite = (placeId) => {
    setFavorites(prev => 
      prev.includes(placeId) 
        ? prev.filter(id => id !== placeId)
        : [...prev, placeId]
    );
  };

  const callGeminiAPI = async (prompt) => {
    const apiKey = 'AIzaSyCWJosTo2BHq3bwUUglmJyzBT4SSXU9ciI';
    
    const contextData = filteredPlaces.slice(0, 10).map(p => {
      const cat = p.category === 'spa' ? 'Spa' : p.category === 'food' ? 'Makanan' : 'Wisata';
      return `${p.name} (${cat}, ${p.distance?.toFixed(1)}km, Rp${p.price.toLocaleString('id-ID')}, Rating: ${p.rating})`;
    }).join(', ');
    
    const systemContext = `Kamu adalah asisten wisata lokal. Data tempat: ${contextData}. Budget: Rp${budget.toLocaleString('id-ID')}. Radius: ${radius}km. Berikan rekomendasi ramah dalam bahasa Indonesia.`;

    try {
      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash?key=${apiKey}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{
            parts: [{ text: `${systemContext}\n\nUser: ${prompt}` }]
          }]
        })
      });

      const data = await response.json();
      return data.candidates?.[0]?.content?.parts?.[0]?.text || 'Maaf, tidak bisa memproses permintaan.';
    } catch (error) {
      const demoText = filteredPlaces.slice(0, 3).map((p, i) => {
        const cat = p.category === 'spa' ? 'Spa' : p.category === 'food' ? 'Makanan' : 'Wisata';
        return `${i+1}. ${p.name}\n- Kategori: ${cat}\n- Jarak: ${p.distance?.toFixed(1)} km\n- Harga: Rp ${p.price.toLocaleString('id-ID')}\n- Rating: ${p.rating}/5\n\n${p.description}`;
      }).join('\n\n');
      
      return `Maaf, terjadi kesalahan API. Pastikan API key sudah diisi.\n\nSebagai demo, berikut rekomendasi:\n\n${demoText}`;
    }
  };

  const handleAISubmit = async () => {
    if (!aiInput.trim()) return;

    const userMsg = aiInput;
    setAiInput('');
    setAiMessages(prev => [...prev, { role: 'user', content: userMsg }]);
    setIsLoading(true);

    const response = await callGeminiAPI(userMsg);
    setAiMessages(prev => [...prev, { role: 'assistant', content: response }]);
    setIsLoading(false);
  };

  const handleMoodSearch = async (selectedMood) => {
    setShowAI(true);
    
    const moodPrompts = {
      stress: 'Aku lagi stress, rekomendasikan tempat spa atau wisata yang menenangkan',
      santai: 'Mau santai-santai, kasih rekomendasi tempat yang cozy',
      capek: 'Lagi capek banget, butuh tempat untuk refresh',
      lapar: 'Lagi lapar, rekomendasikan makanan enak dan terjangkau',
      jalan: 'Pengen jalan-jalan, kasih rekomendasi wisata menarik'
    };

    const prompt = moodPrompts[selectedMood];
    setAiMessages([{ role: 'user', content: prompt }]);
    setIsLoading(true);

    const response = await callGeminiAPI(prompt);
    setAiMessages(prev => [...prev, { role: 'assistant', content: response }]);
    setIsLoading(false);
  };

  return (
    <div style={{ minHeight: '100vh', background: 'linear-gradient(135deg, #0A1E16 0%, #1C3A30 100%)', color: '#CFFFE0' }}>
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; }
        
        @keyframes fadeInUp {
          from { opacity: 0; transform: translateY(30px); }
          to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
          0%, 100% { box-shadow: 0 10px 30px rgba(15, 143, 110, 0.5); }
          50% { box-shadow: 0 10px 50px rgba(15, 143, 110, 0.8); }
        }
        
        @keyframes slideUp {
          from { transform: translateY(100%); }
          to { transform: translateY(0); }
        }
        
        @keyframes typing {
          0%, 60%, 100% { transform: translateY(0); }
          30% { transform: translateY(-10px); }
        }
        
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes zoomIn {
          from { transform: scale(0.8); opacity: 0; }
          to { transform: scale(1); opacity: 1; }
        }
      `}</style>

      <header style={{
        background: 'rgba(10, 30, 22, 0.9)',
        backdropFilter: 'blur(20px)',
        padding: '1.5rem 2rem',
        position: 'sticky',
        top: 0,
        zIndex: 100,
        borderBottom: '1px solid rgba(15, 143, 110, 0.2)'
      }}>
        <div style={{ maxWidth: '1400px', margin: '0 auto', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
          <div style={{
            fontSize: '1.5rem',
            fontWeight: 700,
            background: 'linear-gradient(135deg, #0F8F6E, #CFFFE0)',
            WebkitBackgroundClip: 'text',
            WebkitTextFillColor: 'transparent',
            display: 'flex',
            alignItems: 'center',
            gap: '0.5rem'
          }}>
            <Sparkles size={28} color="#0F8F6E" /> ExploreAI
          </div>
        </div>
      </header>

      <div style={{ padding: '4rem 2rem', textAlign: 'center', maxWidth: '1400px', margin: '0 auto' }}>
        <h1 style={{
          fontSize: '3rem',
          marginBottom: '1rem',
          background: 'linear-gradient(135deg, #CFFFE0, #0F8F6E)',
          WebkitBackgroundClip: 'text',
          WebkitTextFillColor: 'transparent',
          animation: 'fadeInUp 0.8s'
        }}>
          Temukan Tempat Impianmu dengan AI
        </h1>
        <p style={{ fontSize: '1.2rem', opacity: 0.8, marginBottom: '3rem', animation: 'fadeInUp 0.8s 0.2s both' }}>
          Spa, Kuliner, dan Wisata Terdekat dengan Rekomendasi Personal AI
        </p>

        <div style={{
          display: 'flex',
          justifyContent: 'center',
          gap: '1rem',
          flexWrap: 'wrap',
          marginBottom: '3rem',
          animation: 'fadeInUp 0.8s 0.4s both'
        }}>
          {[
            { mood: 'stress', emoji: 'üò≠', text: 'Stress' },
            { mood: 'santai', emoji: 'üòå', text: 'Santai' },
            { mood: 'capek', emoji: 'üò¥', text: 'Capek' },
            { mood: 'lapar', emoji: 'ü§§', text: 'Lapar' },
            { mood: 'jalan', emoji: 'üß≠', text: 'Jalan-jalan' }
          ].map(item => (
            <button
              key={item.mood}
              onClick={() => handleMoodSearch(item.mood)}
              style={{
                background: 'rgba(15, 143, 110, 0.1)',
                border: '2px solid #0F8F6E',
                color: '#CFFFE0',
                padding: '1rem 2rem',
                borderRadius: '50px',
                fontSize: '1.1rem',
                cursor: 'pointer',
                transition: 'all 0.3s'
              }}
              onMouseOver={(e) => {
                e.currentTarget.style.background = '#0F8F6E';
                e.currentTarget.style.transform = 'translateY(-3px)';
              }}
              onMouseOut={(e) => {
                e.currentTarget.style.background = 'rgba(15, 143, 110, 0.1)';
                e.currentTarget.style.transform = 'translateY(0)';
              }}
            >
              {item.emoji} {item.text}
            </button>
          ))}
        </div>

        <div style={{
          background: 'rgba(28, 58, 48, 0.5)',
          backdropFilter: 'blur(20px)',
          padding: '2rem',
          borderRadius: '20px',
          maxWidth: '1000px',
          margin: '0 auto 3rem',
          border: '1px solid rgba(15, 143, 110, 0.2)',
          animation: 'fadeInUp 0.8s 0.6s both'
        }}>
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '2rem' }}>
            <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
              <label style={{ color: '#CFFFE0', fontWeight: 600, fontSize: '0.9rem', textTransform: 'uppercase' }}>
                Radius: <span style={{ color: '#0F8F6E', fontWeight: 700 }}>{radius} km</span>
              </label>
              <input
                type="range"
                min="1"
                max="50"
                value={radius}
                onChange={(e) => setRadius(Number(e.target.value))}
                style={{ accentColor: '#0F8F6E' }}
              />
            </div>
            
            <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
              <label style={{ color: '#CFFFE0', fontWeight: 600, fontSize: '0.9rem', textTransform: 'uppercase' }}>Kategori</label>
              <select
                value={category}
                onChange={(e) => setCategory(e.target.value)}
                style={{
                  background: 'rgba(10, 30, 22, 0.8)',
                  border: '1px solid #0F8F6E',
                  color: '#CFFFE0',
                  padding: '0.8rem',
                  borderRadius: '10px',
                  fontSize: '1rem'
                }}
              >
                <option value="all">Semua</option>
                <option value="spa">Spa</option>
                <option value="food">Kuliner</option>
                <option value="tourism">Wisata</option>
              </select>
            </div>
            
            <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
              <label style={{ color: '#CFFFE0', fontWeight: 600, fontSize: '0.9rem', textTransform: 'uppercase' }}>
                Budget: <span style={{ color: '#0F8F6E', fontWeight: 700 }}>Rp {budget.toLocaleString('id-ID')}</span>
              </label>
              <input
                type="range"
                min="10000"
                max="1000000"
                step="10000"
                value={budget}
                onChange={(e) => setBudget(Number(e.target.value))}
                style={{ accentColor: '#0F8F6E' }}
              />
            </div>
          </div>
        </div>
      </div>

      <div style={{
        maxWidth: '1400px',
        margin: '0 auto',
        padding: '2rem',
        display: 'grid',
        gridTemplateColumns: 'repeat(auto-fill, minmax(320px, 1fr))',
        gap: '2rem'
      }}>
        {filteredPlaces.map(place => {
          const isFav = favorites.includes(place.id);
          const catEmoji = place.category === 'spa' ? 'üíÜ Spa' : place.category === 'food' ? 'üçΩÔ∏è Kuliner' : 'üèûÔ∏è Wisata';
          
          return (
            <div
              key={place.id}
              onClick={() => { setSelectedPlace(place); setShowModal(true); }}
              style={{
                background: 'rgba(28, 58, 48, 0.5)',
                backdropFilter: 'blur(20px)',
                borderRadius: '20px',
                overflow: 'hidden',
                border: '1px solid rgba(15, 143, 110, 0.2)',
                cursor: 'pointer',
                transition: 'all 0.3s',
                animation: 'fadeInUp 0.5s'
              }}
              onMouseOver={(e) => {
                e.currentTarget.style.transform = 'translateY(-10px)';
                e.currentTarget.style.boxShadow = '0 20px 50px rgba(15, 143, 110, 0.3)';
              }}
              onMouseOut={(e) => {
                e.currentTarget.style.transform = 'translateY(0)';
                e.currentTarget.style.boxShadow = 'none';
              }}
            >
              <div style={{
                height: '200px',
                backgroundImage: `url(${place.image})`,
                backgroundSize: 'cover',
                backgroundPosition: 'center',
                position: 'relative'
              }}>
                <button
                  onClick={(e) => { e.stopPropagation(); toggleFavorite(place.id); }}
                  style={{
                    position: 'absolute',
                    top: '1rem',
                    right: '1rem',
                    background: 'rgba(10, 30, 22, 0.9)',
                    border: 'none',
                    padding: '0.5rem',
                    borderRadius: '50%',
                    cursor: 'pointer',
                    display: 'flex'
                  }}
                >
                  <Heart fill={isFav ? '#0F8F6E' : 'none'} stroke={isFav ? '#0F8F6E' : 'white'} />
                </button>
                <div style={{
                  position: 'absolute',
                  bottom: '1rem',
                  left: '1rem',
                  background: 'rgba(15, 143, 110, 0.9)',
                  padding: '0.5rem 1rem',
                  borderRadius: '50px',
                  fontSize: '0.85rem',
                  fontWeight: 600
                }}>
                  {catEmoji}
                </div>
              </div>
              
              <div style={{ padding: '1.5rem' }}>
                <h3 style={{ color: '#CFFFE0', marginBottom: '0.5rem', fontSize: '1.3rem' }}>{place.name}</h3>
                <div style={{ display: 'flex', gap: '1rem', marginBottom: '1rem', flexWrap: 'wrap' }}>
                  <span style={{ display: 'flex', alignItems: 'center', gap: '0.3rem', fontSize: '0.9rem', color: '#0F8F6E' }}>
                    <Star size={14} fill="#FFD700" stroke="#FFD700" /> {place.rating}
                  </span>
                  <span style={{ display: 'flex', alignItems: 'center', gap: '0.3rem', fontSize: '0.9rem', color: '#0F8F6E' }}>
                    <Navigation size={14} /> {place.distance?.toFixed(1)} km
                  </span>
                </div>
                <p style={{ color: 'rgba(207, 255, 224, 0.8)', fontSize: '0.9rem', marginBottom: '1rem', lineHeight: 1.5 }}>
                  {place.description}
                </p>
                <div style={{
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center',
                  paddingTop: '1rem',
                  borderTop: '1px solid rgba(15, 143, 110, 0.2)'
                }}>
                  <span style={{ color: '#0F8F6E', fontWeight: 700, fontSize: '1.1rem' }}>
                    Rp {place.price.toLocaleString('id-ID')}
                  </span>
                  <span style={{ display: 'flex', alignItems: 'center', gap: '0.3rem', fontSize: '0.85rem', color: 'rgba(207, 255, 224, 0.7)' }}>
                    <Clock size={14} /> {place.openHours}
                  </span>
                </div>
              </div>
            </div>
          );
        })}
      </div>

      {!showAI && (
        <button
          onClick={() => setShowAI(true)}
          style={{
            position: 'fixed',
            bottom: '2rem',
            right: '2rem',
            background: 'linear-gradient(135deg, #0F8F6E, #1C3A30)',
            border: 'none',
            width: '60px',
            height: '60px',
            borderRadius: '50%',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            cursor: 'pointer',
            zIndex: 1000,
            animation: 'pulse 2s infinite'
          }}
        >
          <Sparkles color="white" size={28} />
        </button>
      )}

      {showAI && (
        <div style={{
          position: 'fixed',
          bottom: 0,
          right: 0,
          width: '100%',
          maxWidth: '400px',
          height: '600px',
          background: 'rgba(10, 30, 22, 0.95)',
          backdropFilter: 'blur(20px)',
          border: '1px solid #0F8F6E',
          borderRadius: '20px 20px 0 0',
          display: 'flex',
          flexDirection: 'column',
          zIndex: 1001,
          animation: 'slideUp 0.3s'
        }}>
          <div style={{
            padding: '1.5rem',
            borderBottom: '1px solid rgba(15, 143, 110, 0.2)',
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center'
          }}>
            <h3 style={{ display: 'flex', alignItems: 'center', gap: '0.5rem', color: '#0F8F6E' }}>
              <Sparkles size={24} /> AI Assistant
            </h3>
            <button
              onClick={() => setShowAI(false)}
              style={{ background: 'none', border: 'none', color: '#CFFFE0', cursor: 'pointer', padding: '0.5rem', display: 'flex' }}
            >
              <X />
            </button>
          </div>

          <div style={{
            flex: 1,
            overflowY: 'auto',
            padding: '1.5rem',
            display: 'flex',
            flexDirection: 'column',
            gap: '1rem'
          }}>
            {aiMessages.length === 0 && (
              <div style={{ textAlign: 'center', opacity: 0.6, marginTop: '2rem' }}>
                <Sparkles size={48} color="#0F8F6E" style={{ margin: '0 auto 1rem' }} />
                <p>Halo! Saya siap membantu Anda menemukan tempat terbaik. Tanyakan apa saja!</p>
              </div>
            )}
            
            {aiMessages.map((msg, idx) => (
              <div
                key={idx}
                style={{
                  padding: '1rem',
                  borderRadius: '15px',
                  maxWidth: '80%',
                  animation: 'fadeIn 0.3s',
                  whiteSpace: 'pre-wrap',
                  background: msg.role === 'user' ? 'rgba(15, 143, 110, 0.2)' : 'rgba(28, 58, 48, 0.5)',
                  alignSelf: msg.role === 'user' ? 'flex-end' : 'flex-start',
                  border: msg.role === 'user' ? '1px solid #0F8F6E' : '1px solid rgba(15, 143, 110, 0.2)'
                }}
              >
                {msg.content}
              </div>
            ))}
            
            {isLoading && (
              <div style={{ display: 'flex', gap: '0.3rem', padding: '1rem' }}>
                <div style={{ width: '8px', height: '8px', background: '#0F8F6E', borderRadius: '50%', animation: 'typing 1.4s infinite' }} />
                <div style={{ width: '8px', height: '8px', background: '#0F8F6E', borderRadius: '50%', animation: 'typing 1.4s 0.2s infinite' }} />
                <div style={{ width: '8px', height: '8px', background: '#0F8F6E', borderRadius: '50%', animation: 'typing 1.4s 0.4s infinite' }} />
              </div>
            )}
            <div ref={chatEndRef} />
          </div>

          <div style={{ padding: '1.5rem', borderTop: '1px solid rgba(15, 143, 110, 0.2)', display: 'flex', gap: '1rem' }}>
            <input
              type="text"
              value={aiInput}
              onChange={(e) => setAiInput(e.target.value)}
              onKeyPress={(e) => e.key === 'Enter' && handleAISubmit()}
              placeholder="Tanya AI..."
              style={{
                flex: 1,
                background: 'rgba(28, 58, 48, 0.5)',
                border: '1px solid #0F8F6E',
                color: '#CFFFE0',
                padding: '1rem',
                borderRadius: '10px',
                fontSize: '1rem'
              }}
            />
            <button
              onClick={handleAISubmit}
              disabled={isLoading || !aiInput.trim()}
              style={{
                background: '#0F8F6E',
                border: 'none',
                padding: '1rem',
                borderRadius: '10px',
                cursor: 'pointer',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                opacity: isLoading || !aiInput.trim() ? 0.5 : 1
              }}
            >
              <Send color="white" />
            </button>
          </div>
        </div>
      )}

      {showModal && selectedPlace && (
        <div
          onClick={() => setShowModal(false)}
          style={{
            position: 'fixed',
            top: 0,
            left: 0,
            right: 0,
            bottom: 0,
            background: 'rgba(10, 30, 22, 0.9)',
            backdropFilter: 'blur(10px)',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            zIndex: 2000,
            animation: 'fadeIn 0.3s'
          }}
        >
          <div
            onClick={(e) => e.stopPropagation()}
            style={{
              background: 'rgba(28, 58, 48, 0.95)',
              border: '1px solid #0F8F6E',
              borderRadius: '20px',
              maxWidth: '600px',
              width: '90%',
              maxHeight: '90vh',
              overflowY: 'auto',
              position: 'relative',
              animation: 'zoomIn 0.3s'
            }}
          >
            <button
              onClick={() => setShowModal(false)}
              style={{
                position: 'absolute',
                top: '1rem',
                right: '1rem',
                background: 'rgba(10, 30, 22, 0.9)',
                border: '1px solid #0F8F6E',
                padding: '0.5rem',
                borderRadius: '50%',
                cursor: 'pointer',
                display: 'flex',
                zIndex: 10
              }}
            >
              <X color="#CFFFE0" />
            </button>

            <div style={{
              height: '300px',
              backgroundImage: `url(${selectedPlace.image})`,
              backgroundSize: 'cover',
              backgroundPosition: 'center',
              position: 'relative',
              borderRadius: '20px 20px 0 0'
            }}>
              <div style={{
                position: 'absolute',
                bottom: 0,
                left: 0,
                right: 0,
                background: 'linear-gradient(transparent, rgba(10, 30, 22, 0.9))',
                padding: '2rem 2rem 1rem'
              }}>
                <h2 style={{ fontSize: '2rem', marginBottom: '0.5rem' }}>{selectedPlace.name}</h2>
                <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                  <Star fill="#FFD700" stroke="#FFD700" size={20} />
                  <span style={{ fontSize: '1.2rem', fontWeight: 600 }}>{selectedPlace.rating}/5</span>
                </div>
              </div>
            </div>

            <div style={{ padding: '2rem' }}>
              <p style={{ marginBottom: '2rem', lineHeight: 1.6, fontSize: '1.1rem', opacity: 0.9 }}>
                {selectedPlace.description}
              </p>

              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: '1.5rem', marginBottom: '2rem' }}>
                <div style={{
                  background: 'rgba(15, 143, 110, 0.1)',
                  padding: '1rem',
                  borderRadius: '15px',
                  border: '1px solid rgba(15, 143, 110, 0.3)'
                }}>
                  <MapPin size={20} color="#0F8F6E" style={{ marginBottom: '0.5rem' }} />
                  <div>
                    <strong style={{ display: 'block', marginBottom: '0.3rem' }}>Jarak</strong>
                    <p style={{ opacity: 0.8 }}>{selectedPlace.distance?.toFixed(2)} km</p>
                  </div>
                </div>

                <div style={{
                  background: 'rgba(15, 143, 110, 0.1)',
                  padding: '1rem',
                  borderRadius: '15px',
                  border: '1px solid rgba(15, 143, 110, 0.3)'
                }}>
                  <DollarSign size={20} color="#0F8F6E" style={{ marginBottom: '0.5rem' }} />
                  <div>
                    <strong style={{ display: 'block', marginBottom: '0.3rem' }}>Harga</strong>
                    <p style={{ opacity: 0.8 }}>Rp {selectedPlace.price.toLocaleString('id-ID')}</p>
                  </div>
                </div>

                <div style={{
                  background: 'rgba(15, 143, 110, 0.1)',
                  padding: '1rem',
                  borderRadius: '15px',
                  border: '1px solid rgba(15, 143, 110, 0.3)'
                }}>
                  <Clock size={20} color="#0F8F6E" style={{ marginBottom: '0.5rem' }} />
                  <div>
                    <strong style={{ display: 'block', marginBottom: '0.3rem' }}>Jam Buka</strong>
                    <p style={{ opacity: 0.8 }}>{selectedPlace.openHours}</p>
                  </div>
                </div>
              </div>

              <div style={{ marginBottom: '2rem' }}>
                <h4 style={{ marginBottom: '1rem', fontSize: '1.2rem', color: '#0F8F6E' }}>Layanan Tersedia</h4>
                <div style={{ display: 'flex', gap: '0.5rem', flexWrap: 'wrap' }}>
                  {selectedPlace.services.map((service, i) => (
                    <span
                      key={i}
                      style={{
                        background: 'rgba(15, 143, 110, 0.2)',
                        padding: '0.5rem 1rem',
                        borderRadius: '50px',
                        fontSize: '0.9rem',
                        border: '1px solid #0F8F6E'
                      }}
                    >
                      {service}
                    </span>
                  ))}
                </div>
              </div>

              <a
                href={`mailto:?subject=Inquiry tentang ${selectedPlace.name}&body=Halo, saya tertarik dengan ${selectedPlace.name}. Bisa minta informasi detail dan harga paket?`}
                style={{
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  gap: '0.5rem',
                  background: 'linear-gradient(135deg, #0F8F6E, #0C7A5C)',
                  color: 'white',
                  padding: '1rem 2rem',
                  borderRadius: '15px',
                  textDecoration: 'none',
                  fontWeight: 600,
                  fontSize: '1.1rem',
                  transition: 'all 0.3s',
                  border: 'none',
                  cursor: 'pointer'
                }}
                onMouseOver={(e) => {
                  e.currentTarget.style.transform = 'scale(1.05)';
                  e.currentTarget.style.boxShadow = '0 10px 30px rgba(15, 143, 110, 0.4)';
                }}
                onMouseOut={(e) => {
                  e.currentTarget.style.transform = 'scale(1)';
                  e.currentTarget.style.boxShadow = 'none';
                }}
              >
                <Send size={18} /> Minta Penawaran Harga
              </a>
            </div>
          </div>
        </div>
      )}

      {filteredPlaces.length === 0 && userLocation && (
        <div style={{
          textAlign: 'center',
          padding: '4rem 2rem',
          opacity: 0.6
        }}>
          <MapPin size={64} color="#0F8F6E" style={{ margin: '0 auto 1rem' }} />
          <h3 style={{ fontSize: '1.5rem', marginBottom: '1rem' }}>Tidak ada tempat yang sesuai</h3>
          <p>Coba perluas radius pencarian atau tingkatkan budget Anda</p>
        </div>
      )}
    </div>
  );
}
